import{D as b,m as d,A,f as k,p as l,E as g}from"./index-DeSzD2_9.js";const E=b("transactions",()=>{const a=d([]),o=d(!1),T=d(1),f=d(10),t=A(),r=k(),w=l(()=>a.value.length),y=l(()=>a.value.sort((e,s)=>new Date(s.transaccionesFecha).getTime()-new Date(e.transaccionesFecha).getTime()).slice(0,5)),D=l(()=>{const e={};return a.value.forEach(s=>{e[s.transaccionesTipoId]||(e[s.transaccionesTipoId]=[]),e[s.transaccionesTipoId].push(s)}),e}),p=async e=>{var s;try{o.value=!0;const n=e||((s=r.user)==null?void 0:s.userId);if(!n)throw new Error("Usuario no identificado");if(n==="mock-user-id"){const c=[{transaccionesId:1,transaccionesUsuarioId:"mock-user-id",transaccionesTipoId:1,transaccionesPesos:5e4,transaccionesDolares:0,transaccionesFecha:new Date(Date.now()-864e5).toISOString(),transaccionesDescripcion:"Depósito inicial"},{transaccionesId:2,transaccionesUsuarioId:"mock-user-id",transaccionesTipoId:4,transaccionesPesos:-25e3,transaccionesDolares:25,transaccionesFecha:new Date(Date.now()-1728e5).toISOString(),transaccionesDescripcion:"Cambio de moneda"},{transaccionesId:3,transaccionesUsuarioId:"mock-user-id",transaccionesTipoId:3,transaccionesPesos:0,transaccionesDolares:-10,transaccionesFecha:new Date(Date.now()-2592e5).toISOString(),transaccionesDescripcion:"Transferencia"}];a.value=c;return}const i=await g.getTransactionsByUser(n);a.value=Array.isArray(i)?i:[]}catch(n){console.error("Error fetching transactions:",n),t.error("Error al cargar las transacciones"),a.value=[]}finally{o.value=!1}},I=async e=>{var s,n,i;try{if(o.value=!0,((s=r.user)==null?void 0:s.userId)==="mock-user-id"){await new Promise(u=>setTimeout(u,1e3));const m={transaccionesId:Date.now(),transaccionesUsuarioId:"mock-user-id",transaccionesTipoId:e.transaccionesTipoId,transaccionesPesos:e.transaccionesPesos,transaccionesDolares:e.transaccionesDolares,transaccionesFecha:new Date().toISOString(),transaccionesDescripcion:e.transaccionesDescripcion||"Transacción mock"};if(a.value.unshift(m),r.user){const u=r.user.userPesos+e.transaccionesPesos,U=r.user.userDolares+e.transaccionesDolares;r.updateUserBalance(u,U)}return t.success("Transacción creada exitosamente"),!0}const c=await g.createTransaction(e);if(c.success){if(t.success("Transacción creada exitosamente"),await p(),r.user){const m=r.user.userPesos+e.transaccionesPesos,u=r.user.userDolares+e.transaccionesDolares;r.updateUserBalance(m,u)}return!0}else return t.error(c.message||"Error al crear transacción"),!1}catch(c){return console.error("Error creating transaction:",c),t.error(((i=(n=c.response)==null?void 0:n.data)==null?void 0:i.message)||"Error al crear transacción"),!1}finally{o.value=!1}},h=e=>({1:"Depósito",2:"Retiro",3:"Transferencia",4:"Cambio de moneda"})[e]||"Tipo desconocido",S=e=>({1:"text-success-600 bg-success-100",2:"text-danger-600 bg-danger-100",3:"text-primary-600 bg-primary-100",4:"text-warning-600 bg-warning-100"})[e]||"text-gray-600 bg-gray-100",v=(e,s)=>s==="pesos"?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e):new Intl.NumberFormat("es-AR",{style:"currency",currency:"USD"}).format(e),P=e=>new Date(e).toLocaleDateString("es-AR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return{transactions:l(()=>a.value),isLoading:l(()=>o.value),totalTransactions:w,recentTransactions:y,transactionsByType:D,currentPage:T,pageSize:f,fetchTransactions:p,createTransaction:I,getTransactionTypeName:h,getTransactionTypeColor:S,formatAmount:v,formatDate:P}});export{E as u};
